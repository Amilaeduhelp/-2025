<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Protected Access</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 1rem;
}

.container {
  background: white;
  padding: 2.5rem;
  border-radius: 12px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.3);
  width: 100%;
  max-width: 420px;
  animation: slideIn 0.4s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.logo {
  text-align: center;
  font-size: 3.5rem;
  margin-bottom: 1rem;
}

h1 {
  color: #333;
  text-align: center;
  margin-bottom: 0.5rem;
  font-size: 1.8rem;
  font-weight: 600;
}

.subtitle {
  text-align: center;
  color: #666;
  margin-bottom: 2rem;
  font-size: 0.95rem;
}

.input-group {
  margin-bottom: 1rem;
}

label {
  display: block;
  margin-bottom: 0.5rem;
  color: #555;
  font-size: 0.9rem;
  font-weight: 500;
}

input {
  width: 100%;
  padding: 0.9rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s;
  background: #f9f9f9;
}

input:focus {
  outline: none;
  border-color: #667eea;
  background: white;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

button {
  width: 100%;
  padding: 0.9rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1.05rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 0.5rem;
}

button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
button:active { transform: translateY(0); }

.message {
  margin-top: 1rem;
  padding: 0.75rem;
  border-radius: 6px;
  font-size: 0.9rem;
  text-align: center;
  display: none;
  animation: fadeIn 0.3s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.message.show { display: block; }
.message.error { background: #ffebee; color: #c62828; border: 1px solid #ef5350; }
.message.success { background: #e8f5e9; color: #2e7d32; border: 1px solid #66bb6a; }

.info {
  margin-top: 1.5rem;
  padding: 1rem;
  background: #f0f4ff;
  border-left: 4px solid #667eea;
  border-radius: 4px;
  font-size: 0.85rem;
  color: #555;
  line-height: 1.5;
}

.info strong { color: #667eea; }

.action-buttons {
  margin-top: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.secondary-btn {
  background: white;
  color: #667eea;
  border: 2px solid #667eea;
  font-size: 0.95rem;
  padding: 0.8rem;
  font-weight: 500;
}

.secondary-btn:hover {
  background: #667eea;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.whatsapp-btn:hover {
  background: #25D366;
  border-color: #25D366;
  color: white;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s;
}

.modal.show {
  display: flex;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  text-align: center;
  animation: slideIn 0.4s ease-out;
}

.modal-content h2 {
  color: #c62828;
  margin-bottom: 1rem;
}

.modal-content p {
  color: #555;
  margin-bottom: 1.5rem;
  line-height: 1.6;
}

.modal-btn {
  padding: 0.8rem 2rem;
  margin: 0.5rem;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-primary {
  background: #667eea;
  color: white;
}

.btn-primary:hover {
  background: #5568d3;
}
</style>
</head>
<body>

<div class="container">
  <div class="logo">üîê</div>
  <h1>Protected Access</h1>
  <p class="subtitle">Enter your credentials to continue</p>
  
  <div class="input-group">
    <label for="username">Access Code</label>
    <input type="text" id="username" placeholder="Enter access code" autocomplete="username" autofocus>
  </div>
  
  <div class="input-group">
    <label for="password">Password</label>
    <input type="password" id="password" placeholder="Enter password" autocomplete="current-password">
  </div>
  
  <button onclick="verify()">Access Site</button>
  
  <div class="message" id="msg"></div>
  
  <div class="info">
    <strong>‚ÑπÔ∏è Need access?</strong><br>
    Contact the administrator to receive your access credentials.
  </div>
  
  <div class="action-buttons">
    <button class="secondary-btn" onclick="window.location.href='price.html'">
      Password ‡∂ë‡∂ö‡∂ö‡∑ä ‡∑Ñ‡∑è Access Code ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑ô‡∑É‡∑ö ‡∂Ø?
    </button>
    <button class="secondary-btn whatsapp-btn" onclick="window.open('https://wa.me/94716637804', '_blank')">
      üì± Contact
    </button>
  </div>
</div>

<div class="modal" id="logoutModal">
  <div class="modal-content">
    <h2>‚ö†Ô∏è Session Terminated</h2>
    <p>Another user has logged in with your credentials. Your session has been terminated for security reasons.</p>
    <button class="modal-btn btn-primary" onclick="closeModal()">OK</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
var config = {
  redirectUrl: "https://amilaeduhelp.github.io/-2025/note.html",
  sessionTimeout: 24,
  checkInterval: 2000
};

var credentials = {
  "USER001": "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",
  "USER002": "481f6cc0511143ccdd7e2d1b1b94faf0a700a8b49cd13922a70b5ae28acaa8c5",
  "USER003": "5906ac361a137e2d286465cd6588ebb5ac3f5ae955001100bc41577c3d751764",
  "CUST001": "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4",
  "CUST002": "8bb0cf6eb9b17d0f7d22b456f121257dc1254e1f01665370476383ea776df414",
  "ADMIN": "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9",
  "CUST100": "dc658816b8b6be963b4ae5ae4c6befcceb8ac9a8f24b02b7ba1f2e33966137e7",
  "LAK100": "fd3ae3b595e9df173e5ad2163b1053f7cc606df00629da74958b0acc7a1d32e3"
};

function hash(str) {
  return CryptoJS.SHA256(str).toString();
}

function generateSessionId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2);
}

function getSessionKey(user) {
  return 'active_session_' + user;
}

function show(text, type) {
  var m = document.getElementById('msg');
  m.textContent = text;
  m.className = 'message show ' + type;
}

function showLogoutModal() {
  document.getElementById('logoutModal').classList.add('show');
}

function closeModal() {
  document.getElementById('logoutModal').classList.remove('show');
  localStorage.clear();
  sessionStorage.clear();
  window.location.reload();
}

function setActiveSession(user, sessionId) {
  var sessionData = {
    sessionId: sessionId,
    timestamp: Date.now(),
    expires: Date.now() + (config.sessionTimeout * 60 * 60 * 1000),
    lastHeartbeat: Date.now()
  };
  localStorage.setItem(getSessionKey(user), JSON.stringify(sessionData));
}

function getActiveSession(user) {
  var data = localStorage.getItem(getSessionKey(user));
  return data ? JSON.parse(data) : null;
}

function updateHeartbeat(user) {
  var sessionData = getActiveSession(user);
  if (sessionData) {
    sessionData.lastHeartbeat = Date.now();
    localStorage.setItem(getSessionKey(user), JSON.stringify(sessionData));
  }
}

function checkSessionStatus() {
  var user = sessionStorage.getItem('user');
  var sessionId = sessionStorage.getItem('sessionId');
  var auth = sessionStorage.getItem('auth');
  
  if (auth === 'true' && user && sessionId) {
    var activeSession = getActiveSession(user);
    
    if (!activeSession) {
      showLogoutModal();
      return;
    }
    
    if (activeSession.sessionId !== sessionId) {
      showLogoutModal();
      return;
    }
    
    if (Date.now() > activeSession.expires) {
      showLogoutModal();
      return;
    }
    
    updateHeartbeat(user);
  }
}

function verify() {
  var user = document.getElementById('username').value.trim().toUpperCase();
  var pass = document.getElementById('password').value;
  
  if (!user || !pass) {
    show('Please enter both access code and password', 'error');
    return;
  }
  
  var stored = credentials[user];
  
  if (!stored) {
    show('Invalid access code or password', 'error');
    document.getElementById('password').value = '';
    return;
  }
  
  if (hash(pass) === stored) {
    var activeSession = getActiveSession(user);
    
    if (activeSession && Date.now() < activeSession.expires) {
      var timeSinceLastHeartbeat = Date.now() - activeSession.lastHeartbeat;
      if (timeSinceLastHeartbeat < 10000) {
        show('‚ö†Ô∏è This account is already active on another device', 'error');
        document.getElementById('password').value = '';
        return;
      }
    }
    
    show('‚úì Access granted! Redirecting...', 'success');
    
    var sessionId = generateSessionId();
    var expires = new Date();
    expires.setHours(expires.getHours() + config.sessionTimeout);
    
    sessionStorage.setItem('auth', 'true');
    sessionStorage.setItem('user', user);
    sessionStorage.setItem('sessionId', sessionId);
    sessionStorage.setItem('expires', expires.getTime());
    
    setActiveSession(user, sessionId);
    
    setTimeout(function() {
      window.location.href = config.redirectUrl;
    }, 1200);
  } else {
    show('Invalid access code or password', 'error');
    document.getElementById('password').value = '';
  }
}

document.getElementById('username').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') document.getElementById('password').focus();
});

document.getElementById('password').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') verify();
});

window.addEventListener('beforeunload', function() {
  var user = sessionStorage.getItem('user');
  if (user) {
    localStorage.removeItem(getSessionKey(user));
  }
});

var auth = sessionStorage.getItem('auth');
var user = sessionStorage.getItem('user');
var sessionId = sessionStorage.getItem('sessionId');
var exp = sessionStorage.getItem('expires');

if (auth === 'true' && user && sessionId && exp && new Date().getTime() < parseInt(exp)) {
  var activeSession = getActiveSession(user);
  if (activeSession && activeSession.sessionId === sessionId) {
    window.location.href = config.redirectUrl;
  } else {
    sessionStorage.clear();
  }
}

setInterval(checkSessionStatus, config.checkInterval);
</script>

</body>
</html>
